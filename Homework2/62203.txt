Решението започва с преименуване на аргументите с имена, които са по-смислени. Правят се различни проверки като дали аргументите не са повече или по-малко от колкото трябват(4). За всяка проверка връща подходящо съобщение ако тя не е изпълнена. Проверява се дали аргументите са с правилното разширение и дали може да се чете от тях. Ако не са изпълнени тези условия се връща съобщение на конзолата. Последния аргумент трябва да е директория Ако не съществува такава директория тя се създава.

За задаване на времева зона се проверява дали съществува environment променлива EEG_TZ. Ако съществува такава се използва заедно с допълнително дефинираните променливи srd(StartRecordingDate) и srt(StartRecordingTime) за намиране на началното време на eeg.xml в EPOCH формат и се записва в променливата 'eegstart'. Ако1 EEG_TZ не съществува й се задава стойност 'UTC' и се намира същото време.

В променливата 'eegend' се задава стойността на времето в EPOCH формат в което и изпълнен последния tick от eeg.xml файла. Това става като се вземе времето на първия tick от променливата 'eegstart' и се добави продължителността на записване на tick-ове.

В променливата 'wavstart' се записва времето в което е започнал записа на файла larynx.wav в EPOCH формат, който се взема от края на интервала на стимула 'beep' в файла timetable.log.
 	
В променливата 'wavend' се записва времето в което е приключил записа на файла larynx.wav в EPOCH формат, който се пресмята като се вземе началото на записа 'wavstart' и се добави дължината на larynx.wav файла. Тя се намира с помощта на tool-а soxi(Sound eXchange Information) с флага '-D', който извежда дължината на файла в секунди. 
(https://stackoverflow.com/questions/4534372/get-length-of-wav-from-sox-output)

В while цикъл се взема всеки ред от файла timetable.log, като по отделно за всеки ред се изпълнява следното: 
	Дефинира се променлива 'stimulus' с името на стимула от съответния ред
	Дефинира се променлива 'begining' с началото на интервала означен в съответния ред
	Дефинира се променлива 'end' с края на интервала означен в съответния ред

	Проверява се дали съществуват файлове за съответното име на стимула и ако има такива се спира изпълнението на скрипта с код за грешка.
	
	Проверява се дали интервала в съответния ред е по-малък от 0.2 секунди и ако това е изпълнено се принтира съответното съобщение.

	За всеки интервал (begining - end) се проверява дали границите му не излизат от границите на eeg.xml и larynx.wav файловете, ако някой интервал излиза от тези граници се принтира съобщение на конзолата и се пропуска текущия ред от файла. Пресмятаме с калкулатора 'bc' за да могат да се пресмятат интервалите с по-голяма точност.
(https://stackoverflow.com/questions/8654051/how-to-compare-two-floating-point-numbers-in-bash)

	Ако всички нужни условия са изпълнени се изпълнява следното:

		Подрязва се eeg.xml файла така, че да се tick-овете който се записват са в интервала между 'begining' и 'end' и това става в директория $outputdir в файл $stimulus_eeg.xml, това става с командите head -n и tail -n за съответните брой редове.

		Trim-ва се larynx.wav файла така, че да се вземе само интервала от него който е между 'begining' и 'end' и се записва в директория $outputdir в файл $stimulus_lar.wav, това става с tool-a sox trim и съответно пресметнатите начало и край.	 

